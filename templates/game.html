<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <title>Title</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf-8">

        var socket = io();
        socket.on('connect', function() {
            socket.emit('my event', {data: 'I\'m connected!'});
        });



    </script>
    <meta name="viewport" content="width=1280, initial-scale=1">
    <script>       
      document.querySelector('meta[name="viewport"]').setAttribute('content', 'width='+screen.width+', initial-scale=1');
      </script>
    </head>
    <style>
.flex { display : flex }

[draggable] {
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  user-select: none;
  /* Required to make elements draggable in old WebKit */
  -khtml-user-drag: element;
  -webkit-user-drag: element;
}

#columns {
  list-style-type: none;
}

.column {
  width: 162px;
  padding-bottom: 5px;
  padding-top: 5px;
  text-align: center;
  cursor: move;
}
.column header {
  height: 20px;
  width: 150px;
  color: black;
  background-color: #ccc;
  padding: 5px;
  border-bottom: 1px solid #ddd;
  border-radius: 10px;
  border: 2px solid #666666;
}

.column.dragElem {
  opacity: 0.4;
}
.column.over {
  border: 2px dashed #000;
  border-top: 2px solid blue;
}
    </style>

</head>
<body>


<div id="inputScreen">
<h1 id="first2">Enter Wikipedia Article</h1>
<label id="first0" for="artical">Artikelnaam:</label>
<input type="text" id="artName" name="artName"><br><br>
<button id="first1" onclick="sendArt()">Submit</button>
</div>
<div id="submittedArticle">
    <div class="flex">
        <p>Your artical is: </p>
        <p id="articleDisplay"></p>
    </div>
    <input type="text" id ="repart">
    <button id="editButton" onclick="editArticle()">Bewerken</button>
</div>

<!-- Voeg elementen toe om de ontvangen data weer te geven -->
<div id="input">
<p id="artNameDisplay"></p>
<p id="guesserDisplay"></p>
<p id="raderMessage"></p>
<div id="rader">
<div  style="align-items: center; display: flex; justify-content: center; padding: 4rem 0">
    <ul id="columns"></ul>
    
</div>
<button id="submitButton" onclick="submitGuess()">Submit</button>
</div>


</div>
</div>
<div id="res">
<!-- Geraden volgorde -->
<h2 id="res1">Geraden volgorde:</h2>
<ul id="orderList"></ul>

<!-- Het echte artikel -->
<h2 id="res2">Het echte artikel:</h2>
<p id="correctArticle"></p>

<!-- Punten -->
<h2 id="res3">Punten:</h2>
<ul id="pointsList"></ul>
<button id="nextRoundBtn" onclick='socketio.emit("nextRound",{{userID}});'>next round</button>
</div>

<script>

    document.getElementById("nextRoundBtn").style.display = "none";
    var isGessur = false;
    document.getElementById("submittedArticle").style.display = "none";
    document.getElementById("submitButton").style.display = "none";
    var socketio = io();
    var userID = {{userID}};
    document.getElementById("res").style.display = "none";
    document.getElementById("editButton").style.display = "none";
    document.getElementById("repart").style.display = "none";

function sendArt() {
    var article = document.getElementById("artName").value;
    socketio.emit("addArt", {userID: userID, art: article});

    // Display the submitted article
    document.getElementById("articleDisplay").textContent = article;
    document.getElementById("submittedArticle").style.display = "block";

    // Hide the input fields and submit button
    document.getElementById("inputScreen").style.display = "none";
    document.getElementById("editButton").style.display = "block";
    document.getElementById("submittedArticle").style.display = "block";
}
function editArticle() {
    var articleDisplay = document.getElementById("articleDisplay");
    var article = articleDisplay.textContent;

    // Replace the paragraph with an input field to edit the article
    var inputField = document.getElementById("repart");
    inputField.value = article;
    inputField.style.display = "block";

    // Focus on the input field and select its content
    inputField.focus();
    inputField.select();

    // Update the submit button to save the edited article
    var editButton = document.getElementById("editButton");
    editButton.textContent = "Opslaan";
    editButton.setAttribute('onclick','saveArticle()')


}


function saveArticle() {

    // Update the displayed article
    socketio.emit("addArt", {userID: userID, art: document.getElementById("repart").value});
    document.getElementById("articleDisplay").innerText = document.getElementById("repart").value;
    var articleDisplay = document.getElementById("articleDisplay");
    var paragraph = document.createElement("p");
    paragraph.id = "articleDisplay";
    paragraph.textContent = document.getElementById("repart").value;
    articleDisplay.parentNode.replaceChild(paragraph, articleDisplay);

    var editButton = document.getElementById("editButton");
    editButton.textContent = "Bewerken";
    editButton.onclick = editArticle;
    document.getElementById("repart").style.display = "none";

}
socketio.on("startRound", (data) => {
    var artName = data.art;
    var guesserUserID = data.guesserID;
    var guesserName = data.guesserName;
    var guessers = data.players;
    document.getElementById("submittedArticle").style.display = "none";
    document.getElementById("input").style.display = "block";

    if (guesserUserID == userID) {
        // Jij bent de rader
        isGessur = true;
        document.getElementById("raderMessage").textContent = "Jij bent de rader!";
        document.getElementById("rader").style.display = "block";

        // Vul de dropdown-lijst met de andere spelers
        var list = document.getElementById("columns");
        list.innerHTML = "";

        // Voeg de guessers toe aan de lijst met verschuifbare elementen
        for (var i = 0; i < guessers.length; i++) {
            
            var guesser = guessers[i];
            console.log(guesser.id);
            var listItem = document.createElement("div");
            listItem.innerHTML = guesser.name;
            listItem.draggable= true;
            listItem.className = "column";
            listItem.setAttribute('data-value',guesser.id); // Voeg de userID toe als value
            list.appendChild(listItem);
            document.getElementById("submitButton").style.display = "block";
        }
        var cols = document.querySelectorAll('#columns .column');
[].forEach.call(cols, addDnDHandlers);


    } else {
        // Andere speler is de rader
        isGessur = false;
        document.getElementById("raderMessage").textContent = "De rader is: " + guesserName;
        document.getElementById("rader").style.display = "none";
        
    }
    document.getElementById("artNameDisplay").textContent = "Artikelnaam: " + artName;
});
function submitGuess() {
    var listItems = document.getElementsByClassName("columns");
    var guessIDs = [];

    // Haal de ID's op van de listItems en voeg ze toe aan de guessIDs-array
    var columns = document.getElementById("columns"); // Het ul-element met id "columns"
  var divs = columns.getElementsByTagName("div"); // Alle div-elementen binnen het ul-element

  for (var i = 0; i < divs.length; i++) {
    var div = divs[i];
    var text = div.getAttribute('data-value'); // De tekstinhoud van de div zonder eventuele voorloop- of naloopspaties
    guessIDs.push(text); // Voeg de tekstinhoud toe aan de array
  }

    socketio.emit("submitGuess", guessIDs);
};
socketio.on("subbedGuess", (data) => {
    document.getElementById("res").style.display = "block";
    document.getElementById("input").style.display = "none";
    var order = data.order;
    var correct = data.correct;
    var points = data.points;

    // Weergeef de geraden volgorde
    var orderList = document.getElementById("orderList");
    orderList.innerHTML = "";
    for (var playerID in order) {
        var playerName = playerID; // Vervang dit door de functie om de speler naam op te halen
        var guess = order[playerID];
        var listItem = document.createElement("li");
        listItem.textContent = playerName + " - " + guess;
        orderList.appendChild(listItem);
    };

    // Weergeef wie het echte artikel heeft
    var correctArticle = document.getElementById("correctArticle");
    var raderName = correct;
    correctArticle.textContent = "Het echte artikel is van: " + raderName;

    // Weergeef de punten van iedereen
    var pointsList = document.getElementById("pointsList");
    pointsList.innerHTML = "";
    for (var playerID in points) {
        var playerName = playerID; // Vervang dit door de functie om de speler naam op te halen
        var playerPoints = points[playerID];
        var listItem = document.createElement("li");
        listItem.textContent = playerName + " - " + playerPoints + " punten";
        pointsList.appendChild(listItem);
    }
    if (isGessur){
        document.getElementById("nextRoundBtn").style.display = "block";
    } else{
        document.getElementById("nextRoundBtn").style.display = "none";
    }
    
});
socketio.on("next", (data) => {
    document.getElementById("res").style.display = "none";
    if (userID == data){
        document.getElementById("inputScreen").style.display = "block";

    } else{
        document.getElementById("submittedArticle").style.display = "block";


    }
    console.log(data);

});



var dragSrcEl = null;

function handleDragStart(e) {
  // Target (this) element is the source node.
  dragSrcEl = this;

  e.dataTransfer.effectAllowed = 'move';
  e.dataTransfer.setData('text/html', this.outerHTML);

  this.classList.add('dragElem');
}
function handleDragOver(e) {
  if (e.preventDefault) {
    e.preventDefault(); // Necessary. Allows us to drop.
  }
  this.classList.add('over');

  e.dataTransfer.dropEffect = 'move';  // See the section on the DataTransfer object.

  return false;
}

function handleDragEnter(e) {
  // this / e.target is the current hover target.
}

function handleDragLeave(e) {
  this.classList.remove('over');  // this / e.target is previous target element.
}

function handleDrop(e) {
  // this/e.target is current target element.

  if (e.stopPropagation) {
    e.stopPropagation(); // Stops some browsers from redirecting.
  }

  // Don't do anything if dropping the same column we're dragging.
  if (dragSrcEl != this) {
    // Set the source column's HTML to the HTML of the column we dropped on.
    //alert(this.outerHTML);
    //dragSrcEl.innerHTML = this.innerHTML;
    //this.innerHTML = e.dataTransfer.getData('text/html');
    this.parentNode.removeChild(dragSrcEl);
    var dropHTML = e.dataTransfer.getData('text/html');
    this.insertAdjacentHTML('beforebegin',dropHTML);
    var dropElem = this.previousSibling;
    addDnDHandlers(dropElem);
    
  }
  this.classList.remove('over');
  return false;
}

function handleDragEnd(e) {
  // this/e.target is the source node.
  this.classList.remove('over');

  /*[].forEach.call(cols, function (col) {
    col.classList.remove('over');
  });*/
}

function addDnDHandlers(elem) {
  elem.addEventListener('dragstart', handleDragStart, false);
  elem.addEventListener('dragenter', handleDragEnter, false)
  elem.addEventListener('dragover', handleDragOver, false);
  elem.addEventListener('dragleave', handleDragLeave, false);
  elem.addEventListener('drop', handleDrop, false);
  elem.addEventListener('dragend', handleDragEnd, false);

}

var cols = document.querySelectorAll('#columns .column');
[].forEach.call(cols, addDnDHandlers);



</script>



<!-- Dropdown-
